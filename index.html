<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=320; user-scalable=no" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">

    <title>SQLitePlugin test</title>



      <script src="cordova.js"></script>    
      <script src="SQLitePlugin.js"></script>
       <script src="jquery-1.8.2.min.js"></script>

  <!--  <script type="text/javascript" charset="utf-8" src="js/cordova.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/SQLitePlugin.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/qunit-1.5.0.js"></script>-->

    <script type="text/javascript" charset="utf-8" >

       // document.addEventListener("deviceready", doTest, false);
        // this is called when an error happens in a transaction
        function errorHandler(transaction, error) {
            alert('error');
            alert('Error: ' + error.message + ' code: ' + error.code);
 
        }
 
        // this is called when a successful transaction happens
        function successCallBack() {
            alert("DEBUGGING: success");
 
        }
        function nullHandler() { };
      

        var db;
        function onBodyLoad(){

            alert("DEBUGGING: we are in the onBodyLoad() function");
           
            if (!window.sqlitePlugin.openDatabase) {
                // not all mobile devices support databases  if it does not, the following alert will display
                // indicating the device will not be albe to run this application
                alert('Databases are not supported in this browser.');
                return;
            }
 
            db = window.sqlitePlugin.openDatabase({ name: "Database", bgType: 1 });  
           // db = openDatabase(shortName, version, displayName,maxSize);
 
            db.transaction(function (tx) {

                // you can uncomment this next line if you want the User table to be empty each time the application runs
                // tx.executeSql( 'DROP TABLE User',nullHandler,nullHandler);

                // this line actually creates the table User if it does not exist and sets up the three columns and their types
                // note the UserId column is an auto incrementing column which is useful if you want to pull back distinct rows
                // easily from the table.
                tx.executeSql('CREATE TABLE IF NOT EXISTS User(UserId INTEGER NOT NULL PRIMARY KEY, FirstName TEXT NOT NULL, LastName TEXT NOT NULL)', [], nullHandler, errorHandler);
            }, errorHandler, successCallBack);
            alert('table created');
        }

            function AddValueToDB() {
 
                if (!window.sqlitePlugin.openDatabase) {
                    alert('Databases are not supported in this browser.');
                    return;
                }
                db = window.sqlitePlugin.openDatabase({ name: "Database", bgType: 1 });
                // this is the section that actually inserts the values into the User table
                db.transaction(function(transaction) {
                    transaction.executeSql('INSERT INTO User(FirstName, LastName) VALUES (?,?)',[$('#Name').val(), $('#LastName').val()], nullHandler,errorHandler);
                });
 
                // this calls the function that will show what is in the User table in the database
                ListDBValues();
 
                return false;
 
            }

            // list the values in the database to the screen using jquery to update the #lbUsers element
            function ListDBValues() {

                if (!window.sqlitePlugin.openDatabase) {
                    alert('Databases are not supported in this browser.');
                    return;
                }
                db = window.sqlitePlugin.openDatabase({ name: "Database", bgType: 1 });
                // this line clears out any content in the #lbUsers element on the page so that the next few lines will show updated
                // content and not just keep repeating lines
                $('#lbUsers').html('');

                // this next section will select all the content from the User table and then go through it row by row
                // appending the UserId  FirstName  LastName to the  #lbUsers element on the page
                db.transaction(function (transaction) {
                    transaction.executeSql('SELECT * FROM User;', [],
                      function (transaction, result) {
                          if (result != null && result.rows != null) {
                              for (var i = 0; i < result.rows.length; i++) {
                                  var row = result.rows.item(i);
                                  $('#lbUsers').append('<br>' + row.UserId + '. ' + row.FirstName + ' ' + row.LastName);
                              }
                          }
                      }, errorHandler);
                }, errorHandler, nullHandler);

                return;

            }


    

    </script>

  </head>
  <body onload="onBodyLoad()">

      <input id="Name" type="text" />
      <input id="LastName" type="text" />
      <input type="button" value="Add record" onClick="AddValueToDB()">
<input type="button" value="Refresh" onClick="ListDBValues()"> <br>

   <!-- <div id="qunit"></div>-->

      <br>
<span style="font-weight:bold;">Currently stored values:</span>
<span id="lbUsers"></span>
  </body>
</html>
